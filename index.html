
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Gradle and IntelliJ build tooling used in Slack's Android projects">
      
      
        <meta name="author" content="Slack">
      
      
      
      
        <link rel="next" href="platforms/gradle/architecture/">
      
      
      <link rel="icon" href="images/slack_logo_small.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Foundry</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Lato";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="css/app.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#foundry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Foundry" class="md-header__button md-logo" aria-label="Foundry" data-md-component="logo">
      
  <img src="images/slack_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Foundry
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/slackhq/foundry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    foundry
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Foundry" class="md-nav__button md-logo" aria-label="Foundry" data-md-component="logo">
      
  <img src="images/slack_logo.png" alt="logo">

    </a>
    Foundry
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/slackhq/foundry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    foundry
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Overview
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#highlights" class="md-nav__link">
    <span class="md-ellipsis">
      Highlights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Highlights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-project-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Common project configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-dsl" class="md-nav__link">
    <span class="md-ellipsis">
      Feature DSL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Platform plugins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thermal-throttling-capture" class="md-nav__link">
    <span class="md-ellipsis">
      Thermal throttling capture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Better Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-rake" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Rake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-stats-aka-mod-score" class="md-nav__link">
    <span class="md-ellipsis">
      Module Stats (aka &ldquo;Mod Score&rdquo;)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robolectric-jars-management" class="md-nav__link">
    <span class="md-ellipsis">
      Robolectric Jars Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apk-versioning-computers" class="md-nav__link">
    <span class="md-ellipsis">
      APK Versioning Computers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-dependency-versions" class="md-nav__link">
    <span class="md-ellipsis">
      Check dependency versions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agp-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      AGP Handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detekt-baselining" class="md-nav__link">
    <span class="md-ellipsis">
      Detekt baselining
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Misc tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Usage requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commit-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Commit hooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      License
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Platforms
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Platforms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gradle
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Gradle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platforms/gradle/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platforms/gradle/dependency-rake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependency Rake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platforms/gradle/bootstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platforms/gradle/dsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="platforms/gradle/utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utilities
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tools/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/slackhq/foundry/discussions" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discussions ⏏
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Log
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="api/0.x/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="code-of-conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoC
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#highlights" class="md-nav__link">
    <span class="md-ellipsis">
      Highlights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Highlights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-project-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Common project configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-dsl" class="md-nav__link">
    <span class="md-ellipsis">
      Feature DSL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      Platform plugins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thermal-throttling-capture" class="md-nav__link">
    <span class="md-ellipsis">
      Thermal throttling capture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Better Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-rake" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Rake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-stats-aka-mod-score" class="md-nav__link">
    <span class="md-ellipsis">
      Module Stats (aka &ldquo;Mod Score&rdquo;)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robolectric-jars-management" class="md-nav__link">
    <span class="md-ellipsis">
      Robolectric Jars Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apk-versioning-computers" class="md-nav__link">
    <span class="md-ellipsis">
      APK Versioning Computers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-dependency-versions" class="md-nav__link">
    <span class="md-ellipsis">
      Check dependency versions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agp-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      AGP Handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detekt-baselining" class="md-nav__link">
    <span class="md-ellipsis">
      Detekt baselining
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Misc tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Usage requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commit-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Commit hooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      License
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="foundry">foundry<a class="headerlink" href="#foundry" title="Permanent link">&para;</a></h1>
<p>This repository contains much of Slack&rsquo;s Android/Kotlin/JVM tooling for Gradle, IntelliJ, CLIs, and more.</p>
<p>This repo is effectively for Slack&rsquo;s own used but publishes to Maven Central. We <a href="https://slack.engineering/developing-in-the-open/">develop
these in the open</a> to knowledge-share with the community.</p>
<p>As such, we don&rsquo;t normally accept external PRs, but we welcome your questions in the discussions section of the project!</p>
<h2 id="highlights">Highlights<a class="headerlink" href="#highlights" title="Permanent link">&para;</a></h2>
<h3 id="common-project-configuration">Common project configuration<a class="headerlink" href="#common-project-configuration" title="Permanent link">&para;</a></h3>
<p>The <code>foundry.base</code> plugin offers common configuration for all projects implementing it, covering a
wide spectrum of Android, Kotlin, and Java configurations.</p>
<p>This includes a whole host of things!</p>
<ul>
<li>Common Android configuration (single variant libraries, disabling unused features, compose, etc).</li>
<li>Common Kotlin configuration (freeCompilerArgs, JVM target, etc).</li>
<li>Common Java configuration (toolchains, release versions, etc).</li>
<li>Common annotation processors.</li>
<li><code>FoundryExtension</code> (see next section).</li>
<li>Formatting (via Spotless).</li>
<li>Platforms and BOM dependencies (see &ldquo;Platform plugins&rdquo; section below).</li>
<li>Common lint checks (both on Android and plain JVM projects).</li>
</ul>
<p>Full docs can be found in the <a href="platforms/gradle/architecture/">architecture</a> docs.</p>
<h3 id="feature-dsl">Feature DSL<a class="headerlink" href="#feature-dsl" title="Permanent link">&para;</a></h3>
<p>To ease use and configuration of common features in projects, we expose a <code>foundry</code> DSL in projects
that allows for configuration of these in a semantically easy and boilerplate-free way. This is
controlled via <code>FoundryExtension</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">foundry</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">features</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dagger</span><span class="p">()</span>
<span class="w">    </span><span class="n">moshi</span><span class="p">(</span><span class="n">codegen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">android</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">features</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">robolectric</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A major benefit of this is that we can intelligently configure features and avoid applying costly
plugins like Kapt unless they&rsquo;re actually needed for a specific feature, such as Java injections in
projects using Dagger. Since this is pure code, we can also propagate deprecated behavior by
deprecating the corresponding functions in the DSL.</p>
<h3 id="platform-plugins">Platform plugins<a class="headerlink" href="#platform-plugins" title="Permanent link">&para;</a></h3>
<p><code>Platforms.kt</code> contains an implementation that sources a <code>VersionCatalog</code> and applies it to a
Gradle platform project. This allows us to effectively treat our versions catalog as a BOM and apply
it to all projects in the consuming repo and reduce dependency version stratification.</p>
<h3 id="thermal-throttling-capture">Thermal throttling capture<a class="headerlink" href="#thermal-throttling-capture" title="Permanent link">&para;</a></h3>
<p>MacBooks can suffer thermal throttling and result in poor build performance. We built
instrumentation for this to capture these and include them in our build scans to better understand
their impact. We support both Intel and Apple Silicon macs now and contain this implementation in
<code>ThermalsWatcher.kt</code>. This also includes helpful charting APIs for visualizing the data (courtesy
of our friends at Square).</p>
<h3 id="better-properties">Better Properties<a class="headerlink" href="#better-properties" title="Permanent link">&para;</a></h3>
<p>Gradle&rsquo;s built-in property support is limited and has surprising behavior, so we have our own
system on top of it that has consistent precedence, <code>local.properties</code> support, project-local
<code>gradle.properties</code>, and configuration caching support. Check out <code>PropertyResolver</code>.</p>
<h3 id="dependency-rake">Dependency Rake<a class="headerlink" href="#dependency-rake" title="Permanent link">&para;</a></h3>
<p><code>DependencyRake.kt</code> contains an extension to the <code>gradle-dependency-analysis-plugin</code> that applies
its advice to a project to automatically optimize it and <em>rake</em> dependencies.</p>
<h3 id="module-stats-aka-mod-score">Module Stats (aka &ldquo;Mod Score&rdquo;)<a class="headerlink" href="#module-stats-aka-mod-score" title="Permanent link">&para;</a></h3>
<p>As a part of our modularization efforts, we developed a scoring mechanism for modules that we could
use as a measure of their &ldquo;modularization&rdquo;. This includes a number of metrics and weighs them in a
formula to compute a score. This includes LoC, language mixtures, and build graph centrality. This
logic is under the <code>foundry.stats</code> package.</p>
<h3 id="robolectric-jars-management">Robolectric Jars Management<a class="headerlink" href="#robolectric-jars-management" title="Permanent link">&para;</a></h3>
<p>Robolectric uses preinstrumented Android API jars that live on maven central. While it can handle
downloading of these automatically, we found this implementation to be brittle and unreliable, so we
built our own version of it that handles downloading these into a local <code>.cache</code> directory. This
implementation lives in <code>UpdateRobolectricJarsTask.kt</code> and that task is configured to be a
dependency of all <code>Test</code> tasks.</p>
<h3 id="bootstrap">Bootstrap<a class="headerlink" href="#bootstrap" title="Permanent link">&para;</a></h3>
<p>We try to simplify and streamline the bootstrap process for both local development and on CI. This
involves computing optimized JVM arguments for the Gradle and Kotlin daemons (which differ between
CI and local) as well as toe-holds for future customizations. This logic lives in <code>BootstrapTask.kt</code>.</p>
<h3 id="permission-checks">Permission Checks<a class="headerlink" href="#permission-checks" title="Permanent link">&para;</a></h3>
<p>To avoid accidentally checking in any new, unexpected manifest permissions, we have a
<code>CheckManifestPermissionsTask</code> that compares the final merged manifest&rsquo;s permissions to an
allow list of known permissions. This is allow list is checked in and expected to be guarded by a
<code>CODEOWNERS</code> watch and will fail the build if they differ.</p>
<div class="highlight"><pre><span></span><code><span class="n">slack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">android</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">app</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">permissionAllowlist</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;externalRelease&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">setAllowlistFile</span><span class="p">(</span><span class="n">file</span><span class="p">(</span><span class="s">&quot;permissionsAllowlist.txt&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="apk-versioning-computers">APK Versioning Computers<a class="headerlink" href="#apk-versioning-computers" title="Permanent link">&para;</a></h3>
<p>AGP offers new property-based APIs for computing APK version codes and version names. We use this
to compute information from different inputs (CI build number, git state, etc) and control this
logic in <code>ApkVersioningPlugin.kt</code>.</p>
<h3 id="check-dependency-versions">Check dependency versions<a class="headerlink" href="#check-dependency-versions" title="Permanent link">&para;</a></h3>
<p>Sometimes a dependency update may bring with it a surprise update to a transitive dependency that
we also declare. In order to avoid this happening unexpectedly, the <code>CheckDependencyVersionsTask</code>
checks that any transitive dependency versions that also correspond to a version declared in our
<code>VersionCatalog</code> match the version there. It&rsquo;s ok if they don&rsquo;t, but the author just need to update
the version in the catalog too to be explicit (or investigate further if it&rsquo;s an unwanted
surprise!).</p>
<h3 id="agp-handlers">AGP Handlers<a class="headerlink" href="#agp-handlers" title="Permanent link">&para;</a></h3>
<p>AGP occasionally contains new or breaking API changes that we want to handle gracefully in early
testing. We <a href="https://slack.engineering/shadow-jobs/">regularly test against newer preview versions of AGP</a> so we can&rsquo;t just
hardcode in new APIs and expect them to work everywhere. To handle this, we have an <code>AgpHandler</code>
interface that can be used to abstract these new APIs in a backward-compatible way. Then we ship
implementations of this as different artifacts that are built against different AGP versions. Then,
at runtime, we pick the appropriate instance (via service loading) to use for the current AGP
version being used in that build.</p>
<h3 id="detekt-baselining">Detekt baselining<a class="headerlink" href="#detekt-baselining" title="Permanent link">&para;</a></h3>
<p>Detekt is a static analysis tool that we use to check for common issues in our code. We use one
global baseline file for baselined issues (when introducing new checks or updates), but Detekt
doesn&rsquo;t currently support this easily. So, we built <code>MergeDetektBaselinesTask</code> to merge all the
generated baselines from each subproject into a single global baseline.</p>
<h3 id="misc-tools">Misc tools<a class="headerlink" href="#misc-tools" title="Permanent link">&para;</a></h3>
<p>There are a <em>ton</em> of miscellaneous tools, utilities, and glue code for Gradle (and various plugins) sprinkled throughout this project.</p>
<h2 id="usage-requirements">Usage requirements<a class="headerlink" href="#usage-requirements" title="Permanent link">&para;</a></h2>
<p>SGP expects there to be a <code>libs</code> version catalog.</p>
<p>The following versions are required to be set the above catalog.
Their docs can be found in <code>FoundryVersions.kt</code>.</p>
<p>For Android projects, some extra definitions need to be defined</p>
<ul>
<li><code>libs.versions.toml</code> libraries<ul>
<li><code>google-coreLibraryDesugaring</code> - the core library desugaring libraries to use with L8.</li>
</ul>
</li>
<li><code>gradle.properties</code> properties<ul>
<li><code>foundry.compileSdkVersion</code></li>
<li><code>foundry.targetSdkVersion</code></li>
<li><code>foundry.minSdkVersion</code></li>
</ul>
</li>
</ul>
<p>The following plugins are applied by default but can be disabled if you don&rsquo;t need them.</p>
<ul>
<li>Gradle&rsquo;s test retry – <code>foundry.auto-apply.test-retry</code><ul>
<li>By default, this uses the <a href="https://github.com/gradle/test-retry-gradle-plugin">Gradle test-retry plugin</a>, but can be configured to use the Gradle Enterprise plugin&rsquo;s implementation instead by setting the <code>foundry.test.retry.pluginType</code> property to <code>GE</code>.</li>
</ul>
</li>
<li>Spotless – <code>foundry.auto-apply.spotless</code></li>
<li>Detekt – <code>foundry.auto-apply.detekt</code></li>
<li>NullAway – <code>foundry.auto-apply.nullaway</code></li>
<li>Android Cache Fix – <code>foundry.auto-apply.cache-fix</code></li>
</ul>
<h2 id="commit-hooks">Commit hooks<a class="headerlink" href="#commit-hooks" title="Permanent link">&para;</a></h2>
<p>The <code>installCommitHooks</code> task can install commit hooks for formatting kotlin and java files. They expect binaries to be in <code>&lt;root&gt;/config/git/hooks</code> and it&rsquo;s highly recommended to enable git-lfs for these objects. These binaries can be downloaded via the <code>updateKtfmt</code>, <code>updateGjf</code>, etc tasks.</p>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>Copyright 2022 Slack Technologies, LLC

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Slack Technologies, LLC
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>